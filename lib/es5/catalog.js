'use strict';var _templateObject=_taggedTemplateLiteral(['#tab-',''],['#tab-','']),_templateObject2=_taggedTemplateLiteral(['#cat_',''],['#cat_','']),_templateObject3=_taggedTemplateLiteral(['#installed_',''],['#installed_','']);function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var main=function main(){$.ajaxSetup({dataType:'json'}),$('#drawer, #hijab').click(function(){return $('body').toggleClass('list-collapsed')});var a=[new Promise(function(c,d){$.getJSON('/chans/chans.json?v='+new Date().getTime()).done(function(g){catalog.add(g.chans),c({origin:'server',version:g.version})}).fail(function(g){return d(g)})})];localStorage.mydrafts&&function(){var c=null;try{c=JSON.parse(localStorage.mydrafts),catalog.myDraftsRaw=_.cloneDeep(c.chans)}catch(d){localStorage.removeItem('mydrafts'),console.error(d)}c.chans&&a.push(new Promise(function(d){var g=[];c.chans.forEach(function(h){h.name&&h.url&&h.id&&h.id.match(/^[a-z\-_0-9]+$/)?(h.originalID=h.id,h.id+='!draft',g.push(h)):errorBoy.pushError('\u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A #'+h.id+' \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u043A\u0430\u0442\u0430\u043B\u043E\u0433: \u043D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u043B\u0438 \u043D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 ID.')}),catalog.add(g,'drafts'),d({origin:'drafts',version:c.version})}))}();Promise.all(a).then(list.init.bind(list),function(c){return console.error(c)}),$('.tab').click(function(c){var d=$(this).parent().find('.icon');if('block'===d.css('display')&&1==d.css('opacity'))c.stopPropagation(),$('#catalog header').addClass('tab-selecting');else{var g=$(this).text().toLowerCase();switchTab(g)}});var b=localStorage['cat-tab'];b&&switchTab(b),$('#toggle-search').click(function(){$('#catalog').addClass('searching'),$('#search').focus()}),$('#search').on('input',function(){var c=$(this).val().trim().toLowerCase();$('#catalog').toggleClass('search-filter',!!c.length),injector.inject('cat-search','.search-filter .cat-chan[data-search *= "'+c+'"] {display: inline-block}')}),$('#cancel-search').click(function(){$('#catalog').removeClass('searching search-filter'),$('#search').val('')}),$('body').click(function(){return $('#catalog header').removeClass('tab-selecting')}).on('click','.cc-install',function(){var c=$(this).parents('.cat-chan');list.toggle(c[0]._libdata)}).on('click','.make-embed',function(){$(this).parents('.cat-chan').toggleClass('code-on')}).on('dragenter dragend dragover drop dragleave',function(c){c.preventDefault(),c.stopPropagation()}).on('drop',function(c){return handleFile(c.originalEvent)}),$('#up-victim').on('change',function(c){return handleFile(c.originalEvent)}),$('#import-draft').click(function(){return $('#up-victim').click()})};function switchTab(a){$('.tab').removeClass('tab-selected'),$(jq(_templateObject,a)).addClass('tab-selected'),$('#catalog').removeClass('tab-default tab-custom tab-drafts').addClass('tab-'+a),localStorage['cat-tab']=a}var errorBoy={pushError:function pushError(a){$('#error-wrapper').append('<div class="errmsgbox" onclick="this.remove()"><svg id="close-errmsg" class="icon"><use xlink:href="#i-x"></use></svg><p class="error-message">'+_.escape(a)+'</p></div>')}},list={init:function init(a){var b={};a.forEach(function(g){return b[g.origin]=g.origin}),this.versions=b,localStorage.catalogVersions=JSON.stringify(b),this.sortable=Sortable.create(document.querySelector('#boardlist'),{handle:'.dragger',animation:150,onSort:this.sync.bind(this)});var c=localStorage.myChans_new,d=[];if(c){try{c=JSON.parse(c)}catch(g){console.error(g),localStorage.removeItem('myChans_new'),c=null}c&&c.length&&c.forEach(function(g){var h=catalog.chanByID(g.id);h&&d.push(h)})}c||$('.included-chan').each(function(){d.push(this._libdata)}),this.add(d)},add:function add(a){var _this=this;arrayify(a).forEach(function(b){['catbg','offset'].forEach(function(d){return delete b[d]});var c=$(_this.buildChan(b));c[0]._libdata=b,$('#boardlist').append(c),$(jq(_templateObject2,b.id)).addClass('installed')}),this.sync()},buildChan:function buildChan(a){var b=_.escape(a.name),c=a.ball||'/chans/balls/'+a.section+'/'+('drafts'==a.section?'no-ball':a.id)+'.png?uid='+a._id+(a.ballv?'&v='+a.ballv:'');return'<li class="list-chan" id="installed_'+a.id+'" data-id="'+a.id+'"><img src="'+c+'" class="list-chanball"><div class="dragger"><svg class="icon"><use xlink:href="#i-drag"></use></div><div class="list-chan-title">'+(b||'\u0411\u0435\u0437 \u0438\u043C\u0435\u043D\u0438')+'</div><div class="delete-chan" onclick="javascript:list.remove(\''+a.id+'\')"><svg class="icon"><use xlink:href="#i-x"></use></div></li>'},toggle:function toggle(a){_.includes(this.sortable.toArray(),a.id)?this.remove(a.id):this.add(a)},remove:function remove(a){$(jq(_templateObject3,a)).remove(),$(jq(_templateObject2,a)).removeClass('installed'),this.sync()},sync:function sync(){var a=[];document.querySelectorAll('.list-chan').forEach(function(b){a.push(b._libdata)}),localStorage.removeItem('compiledCSS'),localStorage.myChans_new=JSON.stringify(a)}},catalog={add:function add(a,b){var _this2=this;arrayify(a).forEach(function(c){c.section||(c.section=b||(c.default?'default':'custom')),c.url=_.escape(c.url);var d=$(_this2.buildChan(c));d[0]._libdata=c,$('#catalog-contents').append(d)}),$('#import-draft').insertAfter('.cat-chan:last')},buildChan:function buildChan(a){var b=_.escape(a.name),c=a.wiki&&a.wiki.match(/https?:\/\//)?a.wiki:conf.wiki+(a.wiki||b),d=(a.originalID||a.id)+' '+b+' '+a.url.replace(/^https?:\/\//,'')+' '+(a.wiki||'').replace(/^https?:\/\//,''),g=a.ball||'/chans/balls/'+a.section+'/'+('drafts'==a.section?'no-ball':a.id)+'.png?uid='+a._id+(a.ballv?'&v='+a.ballv:'');return'<div class="cat-chan sect-'+a.section+' '+(a.included?'included-chan':'')+'" data-search="'+d.toLowerCase()+'" id="cat_'+a.id+'"><div class="cc-ball-wrap" style="'+makeGradient(a.catbg)+'"><img src="'+g+'" class="cc-ball" '+(a.offset?makeOffset(a.offset):'')+'></img><div class="channame-overlay"><a href="'+a.url+'">'+b+'</a></div></div><div class="cc-toolbar"><button class="cc-install"><span class="cci-i">\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C</span><span class="cci-u">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</span></button></div><div class="chan-options make-embed" title="\u041A\u043E\u0434 \u0434\u043B\u044F \u043A\u043D\u043E\u043F\u043A\u0438"><svg class="icon"><use class="co-code" xlink:href="#i-code"></use><use class="co-close" xlink:href="#i-x"></use></svg></div><a class="chan-options info-link" target="_blank" href="'+c+'" title="\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F"><svg class="icon"><use xlink:href="#i-info"></use></svg></a><textarea onclick="this.select()">'+_.escape('<script src="'+(document.location.origin||document.location.protocol+'//'+document.location.host)+'/embed/add.js" chan="'+a.id+'"></script>')+'</textarea></div>'},chanByID:function chanByID(a){var b=document.querySelector(jq(_templateObject2,a));return b&&b._libdata?b._libdata:null},myDraftsRaw:[],syncRawDrafts:function syncRawDrafts(){localStorage.mydrafts=JSON.stringify({version:new Date().getTime(),chans:this.myDraftsRaw})}};function arrayify(a){return a instanceof Array?a:[a]}var injector={inject:function inject(a,b){var c='injector:'+a,d=document.getElementById(c);if(d)return void(d.innerHTML=b);var g=document.head||document.getElementsByTagName('head')[0],h=document.createElement('style');h.type='text/css',h.id=c,h.styleSheet?h.styleSheet.cssText=b:h.appendChild(document.createTextNode(b)),g.appendChild(h)},remove:function remove(a){var b='injector:'+a,c=document.getElementById(b);if(c){var d=document.head||document.getElementsByTagName('head')[0];d&&d.removeChild(document.getElementById(b))}}};function makeGradient(a){var b='linear-gradient(to bottom, #'+a[0]+' 0%, #'+a[1]+' 100%)',c=/(((?:radial|linear)-gradient)\((?:(ellipse) at center|(-?[0-9]+)deg|to (right|bottom)), ?(.+)\));?/i.exec(b);if(null===c)return'background:'+b;c=_.rest(_.without(c,void 0));var h,d=c[0]+'; ',g=c[1];h=isNaN(c[2])?'bottom'==c[2]?'top, ':'right'==c[2]?'left, ':'center, ellipse cover, ':90-parseFloat(c[2])+'deg, ';var j=c[3];return _.each(['-o-','-webkit-','-moz-'],function(k){d+='background:'+k+g+'('+h+j+'); '}),'background:'+d}function makeOffset(a){var b=a[0],c=a[1],d='';return 0==b&&0==c?d:(['','-webkit-','-ms-','-moz-','-o-'].forEach(function(g){d+=g+'transform: translate('+b+'px, '+c+'px); '}),'style="'+d+'"')}NodeList.prototype.forEach=Array.prototype.forEach;function makeEscapeTagLiteralFn(a){return function(b){var d='';for(var g=0;g<b.length;g++)d+=b[g],g<(1>=arguments.length?0:arguments.length-1)&&(d+=a(arguments.length<=g+1?void 0:arguments[g+1]));return d}}var jq=makeEscapeTagLiteralFn(function(a){return a.replace(/([!"#$%&'()*+,\-./:;<=>?@[\\\]^`{|}~ ])/g,'\\$1')}),conf={wiki:'http://wiki.1chan.ca/'};function reloadFrame(){parent.frames.list.document.location.reload(),parent.openMenu()}window.addEventListener('message',function(){parent.frames.live.document.location.reload()},!1);function handleFile(a){var b='drop'==a.type?a.dataTransfer.files:a.target.files,c=b[0];if(c){var d=new FileReader;d.onload=function(){return function(g){var h=null;try{h=JSON.parse(g.target.result)}catch(j){errorBoy.pushError('\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0440\u0430\u0437\u043E\u0431\u0440\u0430\u0442\u044C JSON')}if(h){if(!(h.name&&h.url&&h.id&&h.id.match(/^[a-z\-_0-9]+$/)))return void errorBoy.pushError('\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0447\u0435\u0440\u043D\u043E\u0432\u0438\u043A. \u041D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u0434\u0430\u043D\u043D\u044B\u0445.');if(_.find(catalog.myDraftsRaw,{id:h.id}))return void errorBoy.pushError('\u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A \u0441 \u0442\u0430\u043A\u0438\u043C id \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442');catalog.myDraftsRaw.push(_.cloneDeep(h)),catalog.syncRawDrafts(),h.id+='!draft',catalog.add(h,'drafts')}}.bind(this)}.bind(this)(c),d.readAsText(c)}}console.info('\u042F \u043D\u0435 \u043D\u0430 \u0430\u043D\u0433\u0443\u043B\u044F\u0440\u0435. \u041D\u0435 \u043D\u0430 \u0430\u043D\u0433\u0443\u043B\u044F\u0440\u0435.');
//# sourceMappingURL=catalog.js.map